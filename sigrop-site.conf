<VirtualHost *:80>
    ServerName sigrop.site
    ServerAlias www.sigrop.site

    # Enable proxy modules
    ProxyPreserveHost On
    ProxyRequests Off
    
    # VULNERABILITY: Allow encoded slashes and don't decode them at Apache level
    AllowEncodedSlashes NoDecode
    
    # Proxy configuration for the Node.js app
    ProxyPass / http://localhost:8080/ nocanon
    ProxyPassReverse / http://localhost:8080/
    
    # VULNERABILITY: Disable path normalization to allow ../
    # This is crucial for path traversal attacks
    ProxyPassInterpolateEnv Off
    
    # Increase limits for potential payloads
    LimitRequestFieldSize 32768
    LimitRequestLine 32768
    
    # VULNERABILITY: Disable security headers that might interfere
    Header unset Server
    Header unset X-Powered-By
    
    # Allow all HTTP methods
    <Location />
        Require all granted
        
        # VULNERABILITY: Don't decode URLs at Apache level
        # Let the application handle the decoding
        AllowEncodedSlashes NoDecode
        
        # Disable mod_security if present
        <IfModule mod_security2.c>
            SecRuleEngine Off
        </IfModule>
        
        # Disable mod_evasive if present
        <IfModule mod_evasive24.c>
            DOSPageCount 1000
            DOSPageInterval 1
            DOSEnabled off
        </IfModule>
    </Location>
    
    # Special handling for uploads path to ensure path traversal works
    <LocationMatch "^/uploads/">
        ProxyPass http://localhost:8080/ nocanon
        ProxyPassReverse http://localhost:8080/
        AllowEncodedSlashes NoDecode
        
        # Don't check for file existence at Apache level
        # Let Node.js handle it
        ProxyErrorOverride Off
    </LocationMatch>
    
    # Logging for debugging
    ErrorLog ${APACHE_LOG_DIR}/sigrop-error.log
    CustomLog ${APACHE_LOG_DIR}/sigrop-access.log combined
    LogLevel info
    
    # Timeout settings
    ProxyTimeout 300
    
    # VULNERABILITY: Don't filter bad headers
    ProxyBadHeader Ignore
    
    # Disable server signature
    ServerSignature Off
</VirtualHost>