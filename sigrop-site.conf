<VirtualHost *:80>
    ServerName sigrop.site
    ServerAlias www.sigrop.site

    # Enable proxy modules
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Allow encoded slashes and don't decode them at Apache level
    AllowEncodedSlashes NoDecode
    
    # Proxy configuration for the Node.js app
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/
    
    # Increase limits for potential payloads
    LimitRequestFieldSize 32768
    LimitRequestLine 32768
    
    # Remove problematic headers
    Header unset Server
    Header unset X-Powered-By
    
    # Allow all HTTP methods
    <Location />
        Require all granted
        
        # Allow encoded slashes
        AllowEncodedSlashes NoDecode
        
        # Disable mod_security if present
        <IfModule mod_security2.c>
            SecRuleEngine Off
        </IfModule>
        
        # Disable mod_evasive if present - corrected module name
        <IfModule mod_evasive20.c>
            DOSPageCount 1000
            DOSPageInterval 1
        </IfModule>
    </Location>
    
    # Special handling for uploads path - fixed regex pattern
    <LocationMatch "^/uploads/.*">
        ProxyPass http://localhost:8080/
        ProxyPassReverse http://localhost:8080/
        AllowEncodedSlashes NoDecode
        ProxyErrorOverride Off
    </LocationMatch>
    
    # Logging for debugging
    ErrorLog ${APACHE_LOG_DIR}/sigrop-error.log
    CustomLog ${APACHE_LOG_DIR}/sigrop-access.log combined
    LogLevel info
    
    # Timeout settings
    ProxyTimeout 300
    
    # Handle bad headers
    ProxyBadHeader Ignore
    
    # Disable server signature
    ServerSignature Off
</VirtualHost>